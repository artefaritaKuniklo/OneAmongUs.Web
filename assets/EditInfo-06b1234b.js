var V=Object.defineProperty;var B=(s,e,t)=>e in s?V(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var d=(s,e,t)=>(B(s,typeof e!="symbol"?e+"":e,t),t);import{v as O,q as g,s as S,r as I}from"./SubmitPrompt-c3e4f537.js";import{V as U,u as j,C as w,B as C,P as D,O as J,z as W,_ as F,t as m}from"./index-34eb284e.js";import{b as T}from"./helper-8d9355a2.js";import{N as u,O as r,V as a,P as $,F as k,Q as P,U as E,ah as q,bk as c,Y as N,Z as M}from"./preload-helper-431254ca.js";var R=Object.defineProperty,A=Object.getOwnPropertyDescriptor,y=(s,e,t,i)=>{for(var o=i>1?void 0:i?A(e,t):e,h=s.length-1,p;h>=0;h--)(p=s[h])&&(o=(i?p(e,t,o):p(o))||o);return i&&o&&R(e,t,o),o};function _(s){let e=0;for(;e<s.length;)!s[e].k&&!s[e].v?s.splice(e,1):++e}let f=class extends U{constructor(){super(...arguments);d(this,"userid");d(this,"p",null);d(this,"initialJson");d(this,"editInfo",[]);d(this,"editWebsites",[]);d(this,"submitParams",null)}json(){return JSON.stringify({info:Object.fromEntries(this.p.info),websites:Object.fromEntries(this.p.websites)},null,2)}created(){fetch(j(w(this.userid),"info.json")).then(t=>t.text()).then(t=>{this.p=O(t),this.initialJson=this.json(),this.p.info.forEach(i=>this.editInfo.push({k:i[0],v:i[1]})),this.p.websites.forEach(i=>this.editWebsites.push({k:i[0],v:i[1]})),this.change()})}change(){for(const t of[this.editInfo,this.editWebsites])t.filter(i=>!i.k&&!i.v).length>1&&_(t),t.filter(i=>!i.k&&!i.v).length==0&&t.push({k:"",v:""})}submitBtn(){_(this.editInfo),_(this.editWebsites),this.p.info=this.editInfo.map(i=>[i.k,i.v]),this.p.websites=this.editWebsites.map(i=>[i.k,i.v]);const t=this.json();if(console.log(t),this.change(),t==this.initialJson){g.alert("什么都没改怎么提交啦 (╯‵□′)╯︵┻━┻","👀",{confirmButtonText:"好好好"});return}this.submitParams={id:this.p.id,content:t}}submitRequest(t){S.success("正在创建更改请求 (Pull Request)...");const i={...this.submitParams,...t};T(W+"/edit/info",{method:"POST",params:i}).then(o=>{console.log(o),g.alert("提交成功！谢谢你。我们将尽快审核您的更改",{cancelButtonText:"好的",type:"warning"})}).catch(o=>{C(o),g.alert("失败原因："+o.message,"提交失败")}),this.submitParams=null}};y([D()],f.prototype,"userid",2);f=y([J({components:{SubmitPrompt:I}})],f);const v=s=>(N("data-v-05ad6d57"),s=s(),M(),s),z={id:"container",class:"fbox-vcenter"},H=v(()=>a("div",{class:"spacer"},null,-1)),L={key:0,id:"EditInfo"},Q=v(()=>a("div",{class:"head-text info"},"信息卡片",-1)),Y={id:"id"},Z={class:"fields info"},G=["onUpdate:modelValue"],K=["onUpdate:modelValue"],X=v(()=>a("div",{class:"head-text websites"},"网站",-1)),x={class:"fields websites"},ss=["onUpdate:modelValue"],es=["onUpdate:modelValue"],ts=v(()=>a("div",{class:"spacer"},null,-1));function is(s,e,t,i,o,h){const p=I;return u(),r("div",z,[H,s.p?(u(),r("div",L,[Q,a("div",Y,"@"+$(s.userid),1),a("div",Z,[(u(!0),r(k,null,P(s.editInfo,(l,b)=>(u(),r("div",{class:"input-box",key:b},[c(a("input",{class:"key","onUpdate:modelValue":n=>l.k=n,onChange:e[0]||(e[0]=(...n)=>s.change&&s.change(...n))},null,40,G),[[m,l.k]]),c(a("input",{class:"value","onUpdate:modelValue":n=>l.v=n,onChange:e[1]||(e[1]=(...n)=>s.change&&s.change(...n))},null,40,K),[[m,l.v]])]))),128))]),X,a("div",x,[(u(!0),r(k,null,P(s.editWebsites,(l,b)=>(u(),r("div",{class:"input-box",key:b},[c(a("input",{class:"key","onUpdate:modelValue":n=>l.k=n,onChange:e[2]||(e[2]=(...n)=>s.change&&s.change(...n))},null,40,ss),[[m,l.k]]),c(a("input",{class:"value","onUpdate:modelValue":n=>l.v=n,onChange:e[3]||(e[3]=(...n)=>s.change&&s.change(...n))},null,40,es),[[m,l.v]])]))),128))]),a("div",{class:"button submit",onClick:e[4]||(e[4]=(...l)=>s.submitBtn&&s.submitBtn(...l))},"提交")])):E("",!0),ts,s.submitParams?(u(),q(p,{key:1,onSubmit:s.submitRequest,onClose:e[5]||(e[5]=()=>s.submitParams=null)},null,8,["onSubmit"])):E("",!0)])}const rs=F(f,[["render",is],["__scopeId","data-v-05ad6d57"]]);export{rs as default,_ as removeEmpty};
